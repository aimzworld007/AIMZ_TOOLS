<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNIFIED AIMZ TOOLS</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter Font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7fa;
        }
        .tool-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .tool-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Ensure the modal is full-width on mobile */
        #notification-modal > div {
            max-width: 90%;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="loading-indicator" class="text-center py-20">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
        <p class="mt-4 text-gray-600">Loading dashboard and connecting to database...</p>
    </div>

    <div id="app-container" class="hidden max-w-7xl mx-auto">

        <!-- Header: RENAMED TO UNIFIED AIMZ TOOLS -->
        <header class="text-center mb-8 sm:mb-12">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-900 tracking-tight">
                UNIFIED AIMZ TOOLS
            </h1>
            <p class="mt-2 text-base sm:text-lg text-gray-500">
                A read-only directory for all essential tools.
            </p>
        </header>

        <!-- Tool Grid: Now uses 1 column on mobile, 2 columns on small screens, and a consistent 3 columns on medium/large screens -->
        <div id="tool-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
            <!-- Tool cards will be generated here -->
        </div>

        <!-- Notification Modal (Custom Alert) -->
        <div id="notification-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 hidden items-center justify-center p-4 z-50">
            <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all scale-100 duration-300">
                <h3 id="modal-title" class="text-xl font-bold mb-3 text-red-600">Error</h3>
                <p id="modal-message" class="text-gray-700 mb-4">An unexpected error occurred.</p>
                <button id="modal-close-btn" class="w-full bg-indigo-600 text-white p-2 rounded-lg font-semibold hover:bg-indigo-700 transition">Close</button>
            </div>
        </div>
        
        <!-- FOOTER CREDIT -->
        <footer class="text-center mt-12 pt-6 border-t border-gray-200">
            <p class="text-sm text-gray-500">
                MADE WITH <span class="text-red-500">‚ù§Ô∏è</span> BY 
                <a href="https://ainulislam.info" target="_blank" class="font-medium text-indigo-600 hover:text-indigo-800 transition">Ainul islam</a>
            </p>
        </footer>

    </div>

    <!-- Firebase Imports and Setup -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global Firebase variables are provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth, userId;
        const COLLECTION_NAME = 'tool_links';
        const DOCUMENT_ID = 'master_tools_list'; // Single document to hold all links

        // Updated initialLinks array with slots 13-16 removed (12 items total)
        const initialLinks = [
            { title: "PDF & IMAGE TOOL", url: "https://pdfimg.netlify.app", icon: "üìÑ" },
            { title: "EID PHOTO LEMINATION TOOL", url: "https://eidlemi.netlify.app", icon: "üí≥" },
            { title: "PDF EDITOR (Under Dev.)", url: "https://propdf.netlify.app", icon: "‚úèÔ∏è" },
            { title: "EID PHOTO VERIFY", url: "https://iaco.netlify.app/", icon: "‚úÖ" },
            { title: "ICO PHOTO TOOL", url: "https://icophoto.netlify.app", icon: "üñºÔ∏è" },
            { title: "REMIT BD", url: "https://remitbd.netlify.app/", icon: "üí∞" },
            { title: "New Tool Slot 7 (Blank)", url: "", icon: "üîó" },
            { title: "New Tool Slot 8 (Blank)", url: "", icon: "üîó" },
            { title: "New Tool Slot 9 (Blank)", url: "", icon: "üîó" },
            { title: "New Tool Slot 10 (Blank)", url: "", icon: "üîó" },
            { title: "New Tool Slot 11 (Blank)", url: "", icon: "üîó" },
            { title: "New Tool Slot 12 (Blank)", url: "", icon: "üîó" },
        ];

        // Prepare links, adding a unique ID for database mapping
        let currentLinks = initialLinks.map((link, index) => ({
            ...link,
            id: `link_${String(index + 1).padStart(2, '0')}`,
        }));

        // --- Utility Functions ---

        /** Shows a custom notification modal instead of alert() */
        function showNotification(title, message, isError = true) {
            const modal = document.getElementById('notification-modal');
            const titleEl = document.getElementById('modal-title');
            const messageEl = document.getElementById('modal-message');

            titleEl.textContent = title;
            messageEl.textContent = message;
            titleEl.className = `text-xl font-bold mb-3 ${isError ? 'text-red-600' : 'text-green-600'}`;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // --- Rendering Functions ---

        /** Renders all tool cards based on the currentLinks state (Read-Only) */
        function renderToolGrid() {
            const grid = document.getElementById('tool-grid');
            grid.innerHTML = ''; // Clear existing content

            currentLinks.forEach((link, index) => {
                const card = document.createElement('div');
                const isActive = link.url.trim().length > 0;

                card.className = `tool-card bg-white p-5 sm:p-6 rounded-xl shadow-md border-t-4 ${isActive ? 'border-indigo-500' : 'border-gray-300'}`;
                card.id = `card-${link.id}`;

                // Render content in read-only mode (No Edit Button)
                card.innerHTML = `
                    <div class="flex items-center justify-start mb-3 sm:mb-4">
                        <span class="text-2xl sm:text-3xl">${link.icon}</span>
                    </div>
                    <h3 class="text-lg sm:text-xl font-bold ${isActive ? 'text-gray-800' : 'text-gray-400'} mb-1">${link.title}</h3>
                    <p class="text-xs text-gray-500 truncate">${isActive ? link.url : 'No URL set (Blank Slot)'}</p>
                    <a href="${isActive ? link.url : '#'}" target="_blank" ${!isActive ? 'onclick="event.preventDefault();"' : ''} id="link-a-${link.id}"
                        class="mt-4 inline-block w-full text-center py-2 rounded-lg font-semibold transition ${isActive
                            ? 'bg-indigo-600 text-white hover:bg-indigo-700 shadow-lg'
                            : 'bg-gray-100 text-gray-500 cursor-not-allowed border'}"
                    >
                        ${isActive ? 'Go to Tool' : 'Add Link'}
                    </a>
                `;
                grid.appendChild(card);
            });
        }


        // --- Firebase Initialization and Data Listener ---

        async function initializeFirebase() {
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Authenticate
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                userId = auth.currentUser?.uid;

                // Start data listener
                listenForLinks();

                // Setup modal close button
                document.getElementById('modal-close-btn').addEventListener('click', () => {
                    document.getElementById('notification-modal').classList.remove('flex');
                    document.getElementById('notification-modal').classList.add('hidden');
                });

                document.getElementById('loading-indicator').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
                document.getElementById('loading-indicator').innerHTML = `
                    <p class="mt-4 text-red-600 font-semibold">
                        Error connecting to Firebase. Data persistence may not work.
                    </p>
                `;
                // Render with initial data even if persistence fails
                renderToolGrid();
                document.getElementById('app-container').classList.remove('hidden');
            }
        }

        function listenForLinks() {
            const docRef = doc(db, `artifacts/${appId}/public/data/${COLLECTION_NAME}`, DOCUMENT_ID);

            // Set up a real-time listener
            onSnapshot(docRef, async (docSnapshot) => {
                if (docSnapshot.exists()) {
                    // Document exists, load the data
                    const data = docSnapshot.data();
                    let updatedLinks = currentLinks.map(link => {
                        const savedData = data[link.id];
                        // Update link properties from Firestore if they exist
                        if (savedData && savedData.title && savedData.url !== undefined) {
                            return { ...link, title: savedData.title, url: savedData.url };
                        }
                        return link; // Keep initial/current state if no saved data
                    });
                    currentLinks = updatedLinks;
                    renderToolGrid();
                } else {
                    // Document doesn't exist, initialize it with the current (pre-populated) links
                    console.log("Document does not exist. Creating initial document.");
                    try {
                        const initialPayload = {};
                        currentLinks.forEach(link => {
                            initialPayload[link.id] = { title: link.title, url: link.url };
                        });
                        // Use a simple retry mechanism
                        const MAX_RETRIES = 3;
                        let success = false;
                        for (let i = 0; i < MAX_RETRIES; i++) {
                            try {
                                await setDoc(docRef, initialPayload);
                                success = true;
                                break;
                            } catch (error) {
                                console.warn(`Attempt ${i + 1} failed to create initial document:`, error);
                                await new Promise(resolve => setTimeout(resolve, 500 * (i + 1)));
                            }
                        }

                        if (!success) {
                             throw new Error("Failed to save initial data after multiple retries.");
                        }
                        renderToolGrid();
                    } catch (e) {
                        console.error("Error creating initial document:", e);
                        showNotification("Initialization Error", "Failed to create initial database record.", true);
                    }
                }
            }, (error) => {
                console.error("Firestore onSnapshot error:", error);
                showNotification("Data Error", "Failed to listen for real-time link updates.", true);
            });
        }

        window.onload = initializeFirebase;
    </script>
</body>
</html>
